import API from"../api";const classCourseFilter="lp-form-course-filter";let timeOutSearch,controller,signal;document.addEventListener("submit",(function(e){const t=e.target;t.classList.contains(classCourseFilter)&&(e.preventDefault(),window.lpCourseFilter.submit(t))})),document.addEventListener("click",(function(e){const t=e.target;t.classList.contains("course-filter-reset")&&(e.preventDefault(),window.lpCourseFilter.reset(t)),window.lpCourseFilter.showHideSearchResult(t),window.lpCourseFilter.triggerInputChoice(t)})),document.addEventListener("keyup",(function(e){e.preventDefault();const t=e.target;t.classList.contains("lp-course-filter-search")&&window.lpCourseFilter.searchSuggestion(t)})),window.lpCourseFilter={searchSuggestion:e=>{if(1!==parseInt(e.dataset.searchSuggest||1))return;const t=e.value.trim(),r=e.closest(`.${classCourseFilter}`),s=r.querySelector(".lp-loading-circle");if(void 0!==timeOutSearch&&clearTimeout(timeOutSearch),t&&t.length>2)s.classList.remove("hide"),timeOutSearch=setTimeout((function(){window.lpCourseFilter.callAPICourseSuggest(t,(e=>{document.querySelector(".lp-course-filter-search-result").innerHTML=e.data.content,s.classList.add("hide")}))}),500);else{r.querySelector(".lp-course-filter-search-result").innerHTML="",s.classList.add("hide")}},callAPICourseSuggest:(e,t,r)=>{void 0!==controller&&controller.abort(),controller=new AbortController,signal=controller.signal;const s=API.apiCourses+"?c_search="+e+"&c_suggest=1";let l={method:"GET"};0!==parseInt(lpData.user_id)&&(l={...l,headers:{"X-WP-Nonce":lpData.nonce}}),fetch(s,{...l,signal:signal}).then((e=>e.json())).then((e=>{void 0!==t&&t(e)})).catch((e=>{console.log(e)})).finally((()=>{void 0!==r&&r()}))},submit:e=>{const t=new FormData(e),r=document.querySelector(".learn-press-courses"),s=document.querySelector(".lp-archive-course-skeleton"),l={paged:1};void 0!==window.lpCourseList&&window.lpCourseList.updateEventTypeBeforeFetch("filter");for(const e of t.entries()){const r=e[0],s=t.getAll(r);l.hasOwnProperty(r)||(l[r]=s)}if("undefined"!=typeof lpSettingCourses&&lpData.is_course_archive&&lpSettingCourses.lpArchiveLoadAjax&&r&&s&&void 0!==window.lpCourseList)window.lpCourseList.triggerFetchAPI(l);else{const e=lpData.courses_url||"",t=new URL(e);Object.keys(l).forEach((e=>{t.searchParams.set(e,l[e])})),document.location.href=t.href}},reset:e=>{const t=e.closest(`.${classCourseFilter}`),r=t.querySelector(".course-filter-submit"),s=t.querySelector(".lp-course-filter-search-result"),l=t.querySelector(".lp-course-filter-search");t.reset(),s&&(s.innerHTML=""),l&&(l.value="");for(let e=0;e<t.elements.length;e++)t.elements[e].removeAttribute("checked");lpData.is_course_archive&&r.click()},showHideSearchResult:e=>{const t=document.querySelector(".lp-course-filter-search-result");if(!t)return;e.closest(".lp-course-filter-search-result")||e.classList.contains("lp-course-filter-search-result")||e.classList.contains("lp-course-filter-search")?t.style.display="block":t.style.display="none"},triggerInputChoice:e=>{if("INPUT"===e.tagName)return;let t;e.classList.contains("lp-course-filter__field")&&(t=e);const r=e.closest(".lp-course-filter__field");r&&(t=r),t&&t.querySelector("input").click()}};