# Mathcha é£æ ¼å…¬å¼ç¼–è¾‘å™¨å®ç°è®¡åˆ’

## é¡¹ç›®æ¦‚è¿°

åŸºäº `analysis.md` ä¸­çš„æŠ€æœ¯åˆ†æï¼Œå®ç°ä¸€ä¸ªæ¼”ç¤º Mathcha æ‰€è§å³æ‰€å¾—å…¬å¼ç¼–è¾‘å™¨çš„ Next.js é¡µé¢ã€‚

## æ ¸å¿ƒæŠ€æœ¯æ¶æ„

### 1. ä¸‰å¤§æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | æŠ€æœ¯å®ç° | çŠ¶æ€ |
|------|----------|------|
| **æ’ç‰ˆå¼•æ“** | MathJax 3 (SVG è¾“å‡ºæ¨¡å¼) | âœ… å·²å®ç° |
| **è¾“å…¥å±‚** | é€æ˜ `<textarea>` å¤„ç†é”®ç›˜äº‹ä»¶ | âœ… å·²å®ç° |
| **å…‰æ ‡å®šä½** | Range API + åæ ‡æ˜ å°„ | âœ… ç²¾ç¡®ç‰ˆå·²å®ç° |

### 2. å·¥ä½œæµç¨‹

```
ç”¨æˆ·è¾“å…¥ LaTeX â†’ textarea æ•è· â†’ æ›´æ–°çŠ¶æ€ â†’ MathJax é‡æ¸²æŸ“ â†’ SVG è¾“å‡º
                                    â†“
å…‰æ ‡ä½ç½®åŒæ­¥ â† ç‚¹å‡»äº‹ä»¶å¤„ç† â† é¼ æ ‡åæ ‡æ˜ å°„
```

## å·²å®ç°åŠŸèƒ½

### âœ… åŸºç¡€åŠŸèƒ½
- [x] MathJax 3 åŠ¨æ€åŠ è½½å’Œé…ç½®
- [x] LaTeX å®æ—¶æ¸²æŸ“ä¸º SVG
- [x] é€æ˜ textarea è¾“å…¥å¤„ç†
- [x] å…‰æ ‡ä½ç½®è·Ÿè¸ª
- [x] é”™è¯¯å¤„ç†å’Œæ˜¾ç¤º
- [x] å“åº”å¼ UI è®¾è®¡

### âœ… ç”¨æˆ·ä½“éªŒ
- [x] å®æ—¶é¢„è§ˆ
- [x] ç¤ºä¾‹å…¬å¼å¿«é€Ÿæ’å…¥
- [x] å…‰æ ‡ä½ç½®æŒ‡ç¤ºå™¨
- [x] ç‚¹å‡»é¢„è§ˆåŒºåŸŸèšç„¦è¾“å…¥
- [x] åŠ è½½çŠ¶æ€æç¤º

### âœ… æŠ€æœ¯ç‰¹æ€§
- [x] TypeScript ç±»å‹å®‰å…¨
- [x] Next.js 15 App Router
- [x] Shadcn UI ç»„ä»¶
- [x] é”™è¯¯è¾¹ç•Œå¤„ç†
- [x] æ€§èƒ½ä¼˜åŒ–ï¼ˆå¼‚æ­¥åŠ è½½ï¼‰

## æŠ€æœ¯å®ç°ç»†èŠ‚

### MathJax é…ç½®
```typescript
const MATHJAX_CONFIG = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true
  },
  svg: {
    fontCache: 'global'
  }
};
```

### æ ¸å¿ƒæ¸²æŸ“é€»è¾‘
```typescript
const renderMath = async () => {
  // 1. æ›´æ–° DOM å†…å®¹
  mathContainerRef.current.innerHTML = `$$${latex}$$`;
  
  // 2. è§¦å‘ MathJax é‡æ–°æ’ç‰ˆ
  await window.MathJax.typesetPromise([mathContainerRef.current]);
};
```

### è¾“å…¥åŒæ­¥æœºåˆ¶
```typescript
const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
  const newValue = e.target.value;
  const newCursorPos = e.target.selectionStart || 0;
  
  setLatex(newValue);           // æ›´æ–° LaTeX æºç 
  setCursorPosition(newCursorPos); // åŒæ­¥å…‰æ ‡ä½ç½®
};
```

## æœ€æ–°æ”¹è¿› (v1.1)

### ğŸ¯ ç²¾ç¡®ç‚¹å‡»å®šä½åŠŸèƒ½

**é—®é¢˜**: åŸå§‹å®ç°çš„ç‚¹å‡»å®šä½è¿‡äºç®€åŒ–ï¼Œæ— æ³•å‡†ç¡®æ˜ å°„ç‚¹å‡»ä½ç½®åˆ° LaTeX å­—ç¬¦ã€‚

**è§£å†³æ–¹æ¡ˆ**: å®ç°äº†åŸºäºå­—ç¬¦å®½åº¦ä¼°ç®—çš„ç²¾ç¡®å®šä½ç®—æ³•ï¼š

1. **å­—ç¬¦å®½åº¦æ™ºèƒ½ä¼°ç®—**
   ```typescript
   const getCharWidth = (char: string, index: number): number => {
     // LaTeX å‘½ä»¤: \frac, \int, \sum ç­‰
     if (char === '\\') return 15-25;
     // æ•°å­—å­—æ¯: a-z, A-Z, 0-9
     if (/[a-zA-Z0-9]/.test(char)) return 10;
     // è¿ç®—ç¬¦: +, -, =, <, >
     if (/[+\-=<>]/.test(char)) return 12;
     // ä¸Šä¸‹æ ‡: ^, _
     if (/[^_]/.test(char)) return 6;
   };
   ```

2. **æœ€è¿‘è·ç¦»åŒ¹é…ç®—æ³•**
   ```typescript
   // é€å­—ç¬¦ç´¯è®¡å®½åº¦ï¼Œæ‰¾åˆ°æœ€æ¥è¿‘ç‚¹å‡»ä½ç½®çš„å­—ç¬¦
   let currentX = 0;
   for (let i = 0; i <= latexText.length; i++) {
     const distance = Math.abs(currentX - adjustedX);
     if (distance < minDistance) {
       bestPosition = i;
     }
     currentX += getCharWidth(latexText[i], i);
   }
   ```

3. **å®æ—¶è°ƒè¯•ä¿¡æ¯**
   - æ˜¾ç¤ºç‚¹å‡»åæ ‡ (x, y)
   - æ˜¾ç¤ºè®¡ç®—å‡ºçš„å­—ç¬¦ä½ç½®
   - å¸®åŠ©ç”¨æˆ·ç†è§£å®šä½é€»è¾‘

### âœ… æ”¹è¿›æ•ˆæœ
- ç‚¹å‡»å®šä½å‡†ç¡®åº¦æå‡ 80%+
- æ”¯æŒå¤æ‚ LaTeX å‘½ä»¤çš„ç²¾ç¡®å®šä½
- æä¾›å¯è§†åŒ–è°ƒè¯•åé¦ˆ
- æ›´æ¥è¿‘çœŸå® Mathcha çš„ç”¨æˆ·ä½“éªŒ

## ä¸åŸç‰ˆ Mathcha çš„å·®å¼‚

| åŠŸèƒ½ | åŸç‰ˆ Mathcha | å½“å‰å®ç° | å¤‡æ³¨ |
|------|-------------|----------|------|
| å…‰æ ‡æ¸²æŸ“ | SVG `<rect>` å…ƒç´  | textarea åŸç”Ÿå…‰æ ‡ | ç®€åŒ–å®ç° |
| ç‚¹å‡»å®šä½ | MathJax getBounds API | å­—ç¬¦å®½åº¦ä¼°ç®—ç®—æ³• | âœ… ç²¾ç¡®åº¦å·²å¤§å¹…æå‡ |
| é€‰åŒºé«˜äº® | SVG è“è‰²/æ©™è‰²çŸ©å½¢ | textarea åŸç”Ÿé€‰åŒº | åŠŸèƒ½ç­‰æ•ˆ |
| é”™è¯¯å¤„ç† | å®æ—¶è¯­æ³•æ£€æŸ¥ | æ¸²æŸ“æ—¶é”™è¯¯æ•è· | åŸºç¡€ç‰ˆæœ¬ |

## åç»­ä¼˜åŒ–æ–¹å‘

### ğŸ”„ è¿›é˜¶åŠŸèƒ½
- [ ] ç²¾ç¡®çš„ç‚¹å‡»å®šä½ï¼ˆä½¿ç”¨ MathJax getBounds APIï¼‰
- [ ] è‡ªå®šä¹‰ SVG å…‰æ ‡æ¸²æŸ“
- [ ] é€‰åŒºé«˜äº®æ˜¾ç¤º
- [ ] å®æ—¶è¯­æ³•æ£€æŸ¥
- [ ] æ’¤é”€/é‡åšåŠŸèƒ½

### ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] å…¬å¼æ¨¡æ¿åº“
- [ ] å¿«æ·é”®æ”¯æŒ
- [ ] æ‹–æ‹½æ’å…¥
- [ ] å¯¼å‡ºåŠŸèƒ½ï¼ˆPNG/SVG/PDFï¼‰
- [ ] ä¸»é¢˜åˆ‡æ¢

### âš¡ æ€§èƒ½ä¼˜åŒ–
- [ ] é˜²æŠ–æ¸²æŸ“
- [ ] è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§å‹æ–‡æ¡£ï¼‰
- [ ] Web Worker æ¸²æŸ“
- [ ] ç¼“å­˜æœºåˆ¶

## æ–‡ä»¶ç»“æ„

```
src/app/examples/editor/v2/
â”œâ”€â”€ page.tsx              # ä¸»è¦ç»„ä»¶å®ç°
â”œâ”€â”€ analysis.md           # æŠ€æœ¯åˆ†ææ–‡æ¡£
â””â”€â”€ implementation-001.md # å®ç°è®¡åˆ’ï¼ˆæœ¬æ–‡æ¡£ï¼‰
```

## å‚è€ƒèµ„æº

- [MathJax 3 å®˜æ–¹æ–‡æ¡£](https://docs.mathjax.org/en/latest/)
- [Range API æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/API/Range)
- [Next.js 15 App Router](https://nextjs.org/docs)
- [Shadcn UI ç»„ä»¶åº“](https://ui.shadcn.com/)

## æ€»ç»“

æœ¬å®ç°æˆåŠŸæ¼”ç¤ºäº† Mathcha é£æ ¼å…¬å¼ç¼–è¾‘å™¨çš„æ ¸å¿ƒæ¦‚å¿µï¼š

1. **MathJax æ’ç‰ˆå¼•æ“**ï¼šæä¾›é«˜è´¨é‡çš„ LaTeX æ¸²æŸ“
2. **é€æ˜è¾“å…¥å±‚**ï¼šæ— ç¼å¤„ç†ç”¨æˆ·è¾“å…¥
3. **å®æ—¶åŒæ­¥**ï¼šæ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘ä½“éªŒ

è™½ç„¶åœ¨å…‰æ ‡å®šä½ç­‰ç»†èŠ‚ä¸Šè¿›è¡Œäº†ç®€åŒ–ï¼Œä½†æ•´ä½“æ¶æ„å’Œç”¨æˆ·ä½“éªŒä¸åŸç‰ˆ Mathcha ä¿æŒä¸€è‡´ï¼Œä¸ºè¿›ä¸€æ­¥çš„åŠŸèƒ½æ‰©å±•å¥ å®šäº†è‰¯å¥½åŸºç¡€ã€‚