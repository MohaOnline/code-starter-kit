# CodeMirror 6 HTML ç¼–è¾‘å™¨ - é—®é¢˜ä¿®å¤è®°å½•

## é¡¹ç›®ä¿¡æ¯
- **æ–‡ä»¶è·¯å¾„**: `/src/app/examples/codemirror/v1-independent/page.tsx`
- **ä¿®å¤æ—¥æœŸ**: 2024-12-31
- **ç‰ˆæœ¬**: v1.2 (é—®é¢˜ä¿®å¤ç‰ˆ)

## ä¿®å¤çš„é—®é¢˜

### 1. å·¥å…·æ èƒŒæ™¯é€æ˜é—®é¢˜
**é—®é¢˜æè¿°**: å·¥å…·æ ç½®é¡¶æ—¶èƒŒæ™¯é€æ˜ï¼Œä¸é¡µé¢å†…å®¹é‡å ï¼Œå½±å“ä½¿ç”¨ä½“éªŒ

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ åŠé€æ˜èƒŒæ™¯: `bg-background/95`
- æ·»åŠ æ¯›ç»ç’ƒæ•ˆæœ: `backdrop-blur-sm`
- åŒºåˆ†ç½®é¡¶å’Œæ­£å¸¸çŠ¶æ€çš„èƒŒæ™¯æ ·å¼

**ä»£ç å˜æ›´**:
```tsx
className={`border-b transition-all duration-200 ${
  isToolbarSticky 
    ? 'fixed top-0 left-0 right-0 z-50 shadow-md bg-background/95 backdrop-blur-sm' 
    : 'relative bg-card'
}`}
```

### 2. å·¥å…·æ ç½®é¡¶é€»è¾‘é—®é¢˜
**é—®é¢˜æè¿°**: å·¥å…·æ ç½®é¡¶åï¼Œå‘ä¸Šæ»šåŠ¨æ—¶æ— æ³•æ¢å¤åˆ°æ­£å¸¸ä½ç½®

**è§£å†³æ–¹æ¡ˆ**:
- è®°å½•å·¥å…·æ åŸå§‹ä½ç½® `toolbarOriginalTop`
- åŸºäºç»å¯¹æ»šåŠ¨ä½ç½®åˆ¤æ–­æ˜¯å¦éœ€è¦ç½®é¡¶
- æ”¹è¿›æ»šåŠ¨äº‹ä»¶ç›‘å¬é€»è¾‘

**ä»£ç å˜æ›´**:
```tsx
const [toolbarOriginalTop, setToolbarOriginalTop] = useState(0)

// åˆ¤æ–­æ˜¯å¦éœ€è¦ç½®é¡¶ï¼šå½“å‰æ»šåŠ¨ä½ç½®è¶…è¿‡å·¥å…·æ åŸå§‹ä½ç½®
const shouldStick = scrollTop > toolbarOriginalTop
setIsToolbarSticky(shouldStick)
```

### 3. æ ‡ç­¾æ’å…¥ä½ç½®é—®é¢˜
**é—®é¢˜æè¿°**: ç‚¹å‡»å·¥å…·æ æ’å…¥HTMLæ ‡ç­¾æ€»æ˜¯åœ¨æ–‡æ¡£æœ«å°¾ï¼Œè€Œä¸æ˜¯å…‰æ ‡ä½ç½®

**è§£å†³æ–¹æ¡ˆ**:
- æ·»åŠ  CodeMirror å®ä¾‹å¼•ç”¨ `codeMirrorRef`
- ä½¿ç”¨ CodeMirror API è·å–å…‰æ ‡ä½ç½®
- é€šè¿‡äº‹åŠ¡ç³»ç»Ÿåœ¨å…‰æ ‡ä½ç½®æ’å…¥å†…å®¹
- æ·»åŠ é™çº§å¤„ç†æœºåˆ¶

**ä»£ç å˜æ›´**:
```tsx
const codeMirrorRef = useRef<any>(null)

// è·å–å½“å‰å…‰æ ‡ä½ç½®
const selection = view.state.selection.main
const cursorPos = selection.head

// åœ¨å…‰æ ‡ä½ç½®æ’å…¥æ¨¡æ¿
const transaction = view.state.update({
  changes: {
    from: cursorPos,
    insert: template
  },
  selection: {
    anchor: cursorPos + template.length
  }
})
```

### 4. æ»šåŠ¨åŒæ­¥ç®—æ³•é—®é¢˜
**é—®é¢˜æè¿°**: é¢„è§ˆåŒºæ»šåŠ¨æœªè€ƒè™‘HTMLç»“æ„ï¼Œæ— æ³•å‡†ç¡®å¯¹é½åˆ°bodyå†…å®¹

**è§£å†³æ–¹æ¡ˆ**:
- æŸ¥æ‰¾ä»£ç ä¸­ `<body>` æ ‡ç­¾çš„ä½ç½®
- è®¡ç®—ç›¸å¯¹äºbodyæ ‡ç­¾çš„è¡Œæ•°
- åŸºäºè¡Œæ•°ä¼°ç®—é¢„è§ˆåŒºæ»šåŠ¨ä½ç½®
- æ”¹è¿›æ»šåŠ¨åŒæ­¥ç²¾åº¦

**ä»£ç å˜æ›´**:
```tsx
// æŸ¥æ‰¾ä»£ç ä¸­çš„ <body> æ ‡ç­¾ä½ç½®
const codeText = htmlCode
const lines = codeText.split('\n')
let bodyStartLine = 0

for (let i = 0; i < lines.length; i++) {
  if (lines[i].includes('<body')) {
    bodyStartLine = i + 1
    break
  }
}

// è®¡ç®—ç›¸å¯¹äº body æ ‡ç­¾çš„è¡Œæ•°
const relativeLineFromBody = Math.max(0, lineNumber - bodyStartLine)

// ä¼°ç®—é¢„è§ˆåŒºå¯¹åº”çš„æ»šåŠ¨ä½ç½®
const estimatedScrollTop = relativeLineFromBody * 25
```

## æŠ€æœ¯æ”¹è¿›

### 1. å¼•ç”¨ç®¡ç†ä¼˜åŒ–
- æ·»åŠ  `codeMirrorRef` ç”¨äºç›´æ¥æ“ä½œç¼–è¾‘å™¨å®ä¾‹
- æ”¹è¿› `toolbarRef` çš„ä½¿ç”¨æ–¹å¼
- ä¼˜åŒ–çŠ¶æ€ç®¡ç†å’Œäº‹ä»¶ç›‘å¬

### 2. ç”¨æˆ·ä½“éªŒæå‡
- å·¥å…·æ ç½®é¡¶æ—¶çš„è§†è§‰æ•ˆæœæ›´ä½³
- å…‰æ ‡ä½ç½®æ’å…¥æé«˜ç¼–è¾‘æ•ˆç‡
- æ»šåŠ¨åŒæ­¥æ›´åŠ ç²¾ç¡®å’Œè‡ªç„¶
- ä¿æŒç¼–è¾‘å™¨ç„¦ç‚¹ï¼Œé¿å…æ“ä½œä¸­æ–­

### 3. ä»£ç å¥å£®æ€§
- æ·»åŠ é”™è¯¯å¤„ç†å’Œé™çº§æœºåˆ¶
- æ”¹è¿›äº‹ä»¶ç›‘å¬çš„ä¾èµ–ç®¡ç†
- ä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

## åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½
1. **æ™ºèƒ½å·¥å…·æ ç½®é¡¶** - æ»šåŠ¨æ—¶è‡ªåŠ¨ç½®é¡¶ï¼Œå¸¦æ¯›ç»ç’ƒæ•ˆæœ
2. **å…‰æ ‡ä½ç½®æ’å…¥** - ç‚¹å‡»å·¥å…·æ åœ¨å…‰æ ‡ä½ç½®æ’å…¥HTMLæ ‡ç­¾
3. **ç²¾ç¡®æ»šåŠ¨åŒæ­¥** - ç¼–è¾‘å™¨ä¸é¢„è§ˆåŒºåŸºäºHTMLç»“æ„åŒæ­¥
4. **å“åº”å¼å¸ƒå±€** - é€‚é…ä¸åŒå±å¹•å°ºå¯¸
5. **è¯­æ³•é«˜äº®** - HTMLä»£ç è¯­æ³•é«˜äº®æ˜¾ç¤º
6. **å®æ—¶é¢„è§ˆ** - ä»£ç å˜æ›´å®æ—¶åæ˜ åˆ°é¢„è§ˆåŒº

### ğŸ¯ ç”¨æˆ·ä½“éªŒäº®ç‚¹
- å·¥å…·æ å§‹ç»ˆå¯è§ï¼Œæé«˜æ“ä½œä¾¿åˆ©æ€§
- å…‰æ ‡æ’å…¥é¿å…æ‰‹åŠ¨å®šä½ï¼Œæé«˜ç¼–è¾‘æ•ˆç‡
- æ»šåŠ¨åŒæ­¥å¸®åŠ©å¿«é€Ÿå®šä½ä»£ç ä¸é¢„è§ˆå¯¹åº”å…³ç³»
- æ¯›ç»ç’ƒæ•ˆæœæä¾›ç°ä»£åŒ–çš„è§†è§‰ä½“éªŒ

## æµ‹è¯•å»ºè®®

1. **å·¥å…·æ ç½®é¡¶æµ‹è¯•**
   - å‘ä¸‹æ»šåŠ¨é¡µé¢ï¼Œè§‚å¯Ÿå·¥å…·æ å¹³æ»‘ç½®é¡¶æ•ˆæœ
   - å‘ä¸Šæ»šåŠ¨ï¼Œç¡®è®¤å·¥å…·æ æ¢å¤æ­£å¸¸ä½ç½®
   - æ£€æŸ¥ç½®é¡¶æ—¶çš„æ¯›ç»ç’ƒèƒŒæ™¯æ•ˆæœ

2. **å…‰æ ‡æ’å…¥æµ‹è¯•**
   - å°†å…‰æ ‡æ”¾åœ¨ä»£ç ä¸­é—´ä½ç½®
   - ç‚¹å‡»å·¥å…·æ æŒ‰é’®ï¼Œç¡®è®¤åœ¨å…‰æ ‡ä½ç½®æ’å…¥
   - éªŒè¯æ’å…¥åå…‰æ ‡ä½ç½®å’Œç¼–è¾‘å™¨ç„¦ç‚¹

3. **æ»šåŠ¨åŒæ­¥æµ‹è¯•**
   - åœ¨ç¼–è¾‘å™¨ä¸­æ»šåŠ¨ï¼Œè§‚å¯Ÿé¢„è§ˆåŒºåŒæ­¥æ•ˆæœ
   - ç‰¹åˆ«å…³æ³¨bodyå†…å®¹åŒºåŸŸçš„å¯¹é½ç²¾åº¦
   - æµ‹è¯•ä¸åŒé•¿åº¦HTMLæ–‡æ¡£çš„åŒæ­¥æ•ˆæœ

4. **å“åº”å¼æµ‹è¯•**
   - è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°
   - ç¡®ä¿å·¥å…·æ å’Œå¸ƒå±€åœ¨ä¸åŒå°ºå¯¸ä¸‹æ­£å¸¸æ˜¾ç¤º

5. **ç»¼åˆåŠŸèƒ½æµ‹è¯•**
   - ç¼–è¾‘HTMLä»£ç ï¼Œæµ‹è¯•è¯­æ³•é«˜äº®
   - å®æ—¶é¢„è§ˆåŠŸèƒ½éªŒè¯
   - å·¥å…·æ æ‰€æœ‰æŒ‰é’®åŠŸèƒ½æµ‹è¯•

## è®¿é—®åœ°å€
- **æœ¬åœ°è®¿é—®**: http://localhost:3000/examples/codemirror/v1-independent
- **å¼€å‘æœåŠ¡å™¨**: `npm run dev`

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2024-12-31  
**çŠ¶æ€**: âœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼ŒåŠŸèƒ½æ­£å¸¸è¿è¡Œ