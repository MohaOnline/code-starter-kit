# 预览点击同步到编辑器功能

## 功能说明

这个功能允许用户在预览区域点击任意位置，编辑器中的光标会自动定位到对应的文本位置。这大大提升了编辑体验，特别是在处理长文档时。

## 使用方法

1. **进入编辑模式**：点击 "Edit" 按钮进入编辑模式
2. **点击预览区域**：在右侧预览区域的任意文本位置点击
3. **自动定位**：左侧编辑器的光标会自动跳转到对应位置并聚焦

## 视觉反馈

- 在编辑模式下，预览区域会显示鼠标悬停效果
- 鼠标悬停时会显示提示文字："点击此处可在编辑器中定位光标位置"
- 点击后编辑器会自动聚焦并滚动到对应位置

## 技术实现

### 核心算法

1. **点击位置检测**：使用 `document.caretRangeFromPoint()` 获取点击位置
2. **文本映射**：将 HTML 渲染后的位置映射回原始文本位置
3. **光标设置**：使用 CodeMirror API 设置光标位置

### 处理的复杂情况

- HTML 标签：自动跳过，不计入文本偏移量
- HTML 实体：正确解码并映射（如 `&lt;` → `<`）
- 代码高亮：处理语法高亮后的 DOM 结构
- 换行符：正确处理不同类型的换行

### 文件修改

1. **Details 组件** (`details.jsx`)：
   - 添加点击事件监听
   - 实现文本位置计算算法
   - 添加视觉反馈

2. **Editor 组件** (`editor.jsx`)：
   - 传递光标位置参数给 HTMLField

3. **HTMLField 组件** (`v01.jsx`)：
   - 接收光标位置参数
   - 使用 CodeMirror API 设置光标位置

4. **状态管理** (`atoms.ts`)：
   - 添加 `cursorPosition` 字段

## 注意事项

- 功能仅在编辑模式下激活
- 复杂的 HTML 结构可能影响映射精度
- 建议在简单的文本结构中使用以获得最佳效果

## 未来改进

- 支持双向同步（编辑器光标变化同步到预览）
- 提高复杂 HTML 结构的映射精度
- 添加平滑滚动动画
- 支持选择范围的同步